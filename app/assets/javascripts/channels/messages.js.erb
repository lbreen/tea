var messageFormContent = document.querySelector('#message_content');
var messages = document.getElementById('messages');

<% Group.all.each do |group| %>

  App['group' + <%= group.id %>] = App.cable.subscriptions.create({channel: 'MessagesChannel', group_id: <%= group.id %> }, {
    received: function(data) {
      // data.message is pre-rendered html from the partial _message.html.erb
      return messages.insertAdjacentHTML('beforeend', data.message);
    },
  });
<% end %>

if (messageFormContent === null) {

} else {
  messageFormContent.addEventListener('keydown', (event) => {
    if (event.key === 'Enter') {
      submitMessage()
    }
  });
}

function submitMessage(){
  var content = messageFormContent.value
  if (content == '') { return false }

  var groupId = messages.dataset.group

  App['group' + groupId].send({content: content, group_id: groupId})

  messageFormContent.value = "" // Reset text input
};
